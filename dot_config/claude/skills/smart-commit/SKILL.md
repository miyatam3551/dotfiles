---
name: smart-commit
description: 変更を分類してコミットするスキル。「変更をコミットして」「分類してコミット」「全部コミットして push」「変更点を整理してコミット」と指示されたときに使用する。
---

# smart-commit

変更ファイルを論理グループに分類し、グループごとに個別コミットしてから push する。
画像ファイルがあれば事前に最適化する。

## 処理フロー

### Step 1: 画像最適化

1. `git status` で変更・新規ファイルに PNG/JPEG が含まれるか確認する
2. PNG がある場合 → `pngquant --quality=65-80 --force --output <file> <file>` で上書き最適化
3. JPEG がある場合 → `jpegoptim --max=80` で最適化
4. 最適化ツール（pngquant / jpegoptim）が未インストールの場合はスキップし、ユーザーに「`brew install pngquant jpegoptim` で導入できます」と警告する
5. 最適化前後のファイルサイズを記録し、後のコミットメッセージに含める（例: `596K→101K`）

### Step 2: 変更の分類

1. `git status`、`git diff --stat`、`git diff --cached --stat` で全変更ファイルを取得する
2. ディレクトリ構造・変更内容を分析し、論理的なグループに分類する
   - 分類基準: 同じ機能・トピック・ディレクトリに属するファイルをまとめる
   - 例: 同じノートとその添付画像、同じ設定ファイル群、同じ機能に関するソースコード群
3. 分類結果をテーブル形式でユーザーに提示し、確認を取る

### Step 3: グループごとにコミット

1. `git log --oneline -5` で既存のコミットメッセージスタイルを確認する
2. 各グループについて `git add <files>` → `git commit` で個別コミットを作成する
3. コミットメッセージは既存スタイルに合わせる（日本語メッセージなら日本語で）
4. 画像最適化があった場合:
   - 画像と同じトピックのファイルがあれば、そのグループのコミットに含める
   - 画像だけが変更の場合は「添付画像を最適化」のような独立コミットにする
5. コミットメッセージには HEREDOC 形式を使う:
   ```
   git commit -m "$(cat <<'EOF'
   メッセージ
   EOF
   )"
   ```

### Step 4: push

1. 全コミット完了後、`git push` を実行する
2. リモートブランチが未設定の場合は `git push -u origin <branch>` を使う
